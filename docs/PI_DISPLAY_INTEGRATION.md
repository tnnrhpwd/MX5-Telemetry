# MX5 Raspberry Pi + ESP32-S3 Display Integration

## Project Overview

Integrate a Raspberry Pi 4 (HDMI output to Pioneer AVH-W4500NEX) and ESP32-S3 Round Display into the 2008 MX5 NC GT, controlled via stock steering wheel buttons through CAN bus.

### Goals
- Display telemetry data on ESP32-S3 round LCD (gauges, RPM, speed)
- Display apps/media on Raspberry Pi via HDMI to Pioneer head unit
- Control both devices using stock MX5 steering wheel buttons (no touch needed)
- Read vehicle data from HS-CAN and MS-CAN buses

---

## Hardware Components

| Component | Purpose | Docs |
|-----------|---------|------|
| Raspberry Pi 4B | HDMI output to Pioneer AVH-W4500NEX | - |
| ESP32-S3 Round Display | 1.85" gauge display (new CAN hub) | - |
| Arduino Nano | RPM LED strip controller | [WIRING_GUIDE.md](hardware/WIRING_GUIDE.md) |
| MCP2515 Module x2 | CAN bus readers (HS + MS) for ESP32-S3 | [WIRING_GUIDE.md](hardware/WIRING_GUIDE.md) |
| Pioneer AVH-W4500NEX | Head unit with HDMI input | - |
| WS2812B LED Strip | RPM shift light (20 LEDs) | [WIRING_GUIDE.md](hardware/WIRING_GUIDE.md) |
| OBD-II Breakout | Access CAN bus pins | [WIRING_GUIDE.md](hardware/WIRING_GUIDE.md) |
| LM2596 Buck Converter | 12V â†’ 5V power | [WIRING_GUIDE.md](hardware/WIRING_GUIDE.md) |

---

## MX5 NC CAN Bus Architecture

### Bus Specifications

| Bus | Speed | OBD Pins | Data Available |
|-----|-------|----------|----------------|
| **HS-CAN** | 500 kbps | 6 (H), 14 (L) | Engine RPM, Speed, Throttle, Temps, Gear |
| **MS-CAN** | 125 kbps | 3 (H), 11 (L) | Steering Wheel Buttons, Cruise Control, Body |

### Steering Wheel Button CAN Messages

#### Audio Controls (Left Side)
| Button | CAN ID | Byte 0 Value |
|--------|--------|--------------|
| Volume Up | `0x240` | `0x01` |
| Volume Down | `0x240` | `0x02` |
| Mode/Source | `0x240` | `0x04` |
| Seek/Track Up | `0x240` | `0x08` |
| Seek/Track Down | `0x240` | `0x10` |
| Mute | `0x240` | `0x20` |

#### Cruise Control (Right Side)
| Button | CAN ID | Byte Value |
|--------|--------|------------|
| ON/OFF | `0x250` | `0x01` |
| Cancel | `0x250` | `0x02` |
| RES+ (Resume/Accel) | `0x250` | `0x04` |
| SET- (Set/Decel) | `0x250` | `0x08` |

> âš ï¸ **Note**: CAN IDs need verification by sniffing actual bus traffic

---

## System Architecture

### Block Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MX5 NC CAN BUS ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         OBD-II PORT                                  â”‚   â”‚
â”‚   â”‚   Pin 6 â”€â”€â”€â”¬â”€â”€â”€ HS-CAN High (500kbps)                               â”‚   â”‚
â”‚   â”‚   Pin 14 â”€â”€â”¼â”€â”€â”€ HS-CAN Low                                          â”‚   â”‚
â”‚   â”‚   Pin 3 â”€â”€â”€â”¼â”€â”€â”€ MS-CAN High (125kbps)                               â”‚   â”‚
â”‚   â”‚   Pin 11 â”€â”€â”´â”€â”€â”€ MS-CAN Low                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                              â”‚                             â”‚
â”‚                 â–¼                              â–¼                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                  â”‚
â”‚      HS-CAN BUS (500k)               MS-CAN BUS (125k)                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                  â”‚
â”‚         â”‚                                â”‚                                   â”‚
â”‚         â–¼                                â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚ MCP2515  â”‚                    â”‚ MCP2515  â”‚                              â”‚
â”‚   â”‚ #1 (HS)  â”‚                    â”‚ #2 (MS)  â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚        â”‚                               â”‚                                     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚          â”‚      ESP32-S3       â”‚                                             â”‚
â”‚          â”‚     MAIN HUB        â”‚                                             â”‚
â”‚          â”‚                     â”‚                                             â”‚
â”‚          â”‚  â€¢ Reads HS-CAN     â”‚                                             â”‚
â”‚          â”‚  â€¢ Reads MS-CAN     â”‚                                             â”‚
â”‚          â”‚  â€¢ Round LCD Displayâ”‚                                             â”‚
â”‚          â”‚  â€¢ Forwards to Pi   â”‚                                             â”‚
â”‚          â”‚  â€¢ Forwards to LED  â”‚                                             â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                 â”‚       â”‚                                                    â”‚
â”‚     Serial/UART â”‚       â”‚ WiFi/Serial                                       â”‚
â”‚     (RPM only)  â”‚       â”‚ (All data + buttons)                              â”‚
â”‚                 â–¼       â–¼                                                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚        â”‚Arduino Nanoâ”‚  â”‚Raspberry Piâ”‚                                       â”‚
â”‚        â”‚  RPM LEDs  â”‚  â”‚   HDMI     â”‚â”€â”€â”€â”€â”€â”€â–¶ Pioneer AVH-W4500NEX           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

```
HS-CAN (500kbps)                    MS-CAN (125kbps)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ RPM                               â€¢ Steering Wheel Buttons
â€¢ Vehicle Speed                     â€¢ Cruise Control Buttons
â€¢ Throttle Position                 â€¢ Door Status
â€¢ Engine Temp                       â€¢ Lights Status
â€¢ Gear Position                     â€¢ Climate Control

        â”‚                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚      ESP32-S3       â”‚
             â”‚    (MAIN HUB)       â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  LOCAL   â”‚  â”‚ ARDUINO  â”‚  â”‚    PI    â”‚
  â”‚ DISPLAY  â”‚  â”‚  (LED)   â”‚  â”‚  (HDMI)  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ RPM Gaugeâ”‚  â”‚ RPM only â”‚  â”‚ All Data â”‚
  â”‚ Speed    â”‚  â”‚ via UART â”‚  â”‚ + SWC    â”‚
  â”‚ Buttons  â”‚  â”‚          â”‚  â”‚ Commands â”‚
  â”‚ (React)  â”‚  â”‚          â”‚  â”‚ via WiFi â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Wiring Diagrams

### ESP32-S3 Pin Assignments

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ESP32-S3 WIRING DIAGRAM                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ESP32-S3 Pin      â”‚  Connection                                           â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â”‚                     â”‚                                                        â”‚
â”‚   --- MCP2515 #1 (HS-CAN) via SPI Bus 1 ---                                 â”‚
â”‚   GPIO 12 (SCK)     â”‚  MCP2515 #1 SCK                                       â”‚
â”‚   GPIO 11 (MOSI)    â”‚  MCP2515 #1 SI                                        â”‚
â”‚   GPIO 13 (MISO)    â”‚  MCP2515 #1 SO                                        â”‚
â”‚   GPIO 10 (CS1)     â”‚  MCP2515 #1 CS                                        â”‚
â”‚   GPIO 9  (INT1)    â”‚  MCP2515 #1 INT                                       â”‚
â”‚                     â”‚                                                        â”‚
â”‚   --- MCP2515 #2 (MS-CAN) via SPI Bus 2 ---                                 â”‚
â”‚   GPIO 36 (SCK2)    â”‚  MCP2515 #2 SCK                                       â”‚
â”‚   GPIO 35 (MOSI2)   â”‚  MCP2515 #2 SI                                        â”‚
â”‚   GPIO 37 (MISO2)   â”‚  MCP2515 #2 SO                                        â”‚
â”‚   GPIO 34 (CS2)     â”‚  MCP2515 #2 CS                                        â”‚
â”‚   GPIO 38 (INT2)    â”‚  MCP2515 #2 INT                                       â”‚
â”‚                     â”‚                                                        â”‚
â”‚   --- Serial to Arduino (RPM LED) ---                                       â”‚
â”‚   GPIO 43 (TX)      â”‚  Arduino D2 (RX via SoftwareSerial)                   â”‚
â”‚   GPIO 44 (RX)      â”‚  Arduino D3 (TX) [optional feedback]                  â”‚
â”‚                     â”‚                                                        â”‚
â”‚   --- Serial/WiFi to Raspberry Pi ---                                       â”‚
â”‚   GPIO 17 (TX2)     â”‚  Pi GPIO 15 (RXD) [or use WiFi]                       â”‚
â”‚   GPIO 18 (RX2)     â”‚  Pi GPIO 14 (TXD) [or use WiFi]                       â”‚
â”‚                     â”‚                                                        â”‚
â”‚   --- Display (already wired on module) ---                                 â”‚
â”‚   Internal SPI      â”‚  GC9A01 LCD                                           â”‚
â”‚   Internal I2C      â”‚  Touch FT5x06                                         â”‚
â”‚                     â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MCP2515 Module Connections

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP2515 MODULE CONNECTIONS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   MCP2515 #1 (HS-CAN)          MCP2515 #2 (MS-CAN)                          â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                          â”‚
â”‚                                                                              â”‚
â”‚   VCC â”€â”€â”€â”€ 3.3V                VCC â”€â”€â”€â”€ 3.3V                                â”‚
â”‚   GND â”€â”€â”€â”€ GND                 GND â”€â”€â”€â”€ GND                                 â”‚
â”‚   CS  â”€â”€â”€â”€ GPIO 10             CS  â”€â”€â”€â”€ GPIO 34                             â”‚
â”‚   SO  â”€â”€â”€â”€ GPIO 13             SO  â”€â”€â”€â”€ GPIO 37                             â”‚
â”‚   SI  â”€â”€â”€â”€ GPIO 11             SI  â”€â”€â”€â”€ GPIO 35                             â”‚
â”‚   SCK â”€â”€â”€â”€ GPIO 12             SCK â”€â”€â”€â”€ GPIO 36                             â”‚
â”‚   INT â”€â”€â”€â”€ GPIO 9              INT â”€â”€â”€â”€ GPIO 38                             â”‚
â”‚                                                                              â”‚
â”‚   CANH â”€â”€â”€ OBD Pin 6           CANH â”€â”€â”€ OBD Pin 3                           â”‚
â”‚   CANL â”€â”€â”€ OBD Pin 14          CANL â”€â”€â”€ OBD Pin 11                          â”‚
â”‚                                                                              â”‚
â”‚   âš ï¸  120Î© terminator usually not needed when tapping OBD port              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Existing Arduino LED RPM System

> âš ï¸ **This system already exists and is working!** See `docs/hardware/WIRING_GUIDE.md` for detailed setup instructions.

The Arduino Nano RPM LED controller is already implemented in this repo. In the new integrated system, instead of reading CAN directly, it will receive RPM data via Serial from the ESP32-S3 hub.

### Arduino Nano Pin Configuration

From `lib/Config/config.h`:

| Pin | Function | Connection |
|-----|----------|------------|
| **D5** | LED Data | WS2812B Data In |
| **D10** | CAN CS | MCP2515 CS (current) â†’ **Not needed in new design** |
| **D7** | CAN INT | MCP2515 INT (current) â†’ **Not needed in new design** |
| **D11** | SPI MOSI | MCP2515 SI (current) â†’ **Not needed in new design** |
| **D12** | SPI MISO | MCP2515 SO (current) â†’ **Not needed in new design** |
| **D13** | SPI SCK | MCP2515 SCK (current) â†’ **Not needed in new design** |
| **D2** | Serial RX | **NEW: ESP32-S3 GPIO 43 (TX)** |
| **5V** | Power | VCC from buck converter |
| **GND** | Ground | Common ground |

### LED Configuration

From `lib/Config/config.h`:

```cpp
#define LED_COUNT 20           // 20x WS2812B LEDs
#define LED_BRIGHTNESS 50      // 0-255 default brightness
#define LED_FADE_SPEED 15      // Fade animation speed
```

### RPM Thresholds

From `lib/Config/config.h`:

```cpp
#define RPM_IDLE        800    // Below this = idle
#define RPM_MIN_DISPLAY 1000   // Start lighting LEDs
#define RPM_MAX         7000   // Full LED bar
#define RPM_SHIFT       6500   // Shift light flash
#define RPM_REDLINE     7200   // Redline warning
```

### WS2812B LED Strip Wiring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       WS2812B LED STRIP WIRING                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Arduino Nano             WS2812B Strip (20 LEDs)                          â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                          â”‚
â”‚                                                                              â”‚
â”‚   D5 (LED Data) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ DIN (Data In)                                   â”‚
â”‚   5V â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ VCC (through 100ÂµF cap)                         â”‚
â”‚   GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ GND                                             â”‚
â”‚                                                                              â”‚
â”‚   âš ï¸  Add 330Î© resistor between D5 and DIN for signal protection            â”‚
â”‚   âš ï¸  Add 100ÂµF capacitor across VCC/GND near first LED                      â”‚
â”‚   âš ï¸  20 LEDs @ max brightness can draw ~1.2A - ensure adequate power        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Arduino Integration: Current vs New Design

**CURRENT DESIGN** (standalone, reads CAN directly):
```
                     MCP2515
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    OBD-II HS-CAN â”€â”¤ CAN H/L â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                        â”‚ SPI (D10-D13)
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Arduino  â”‚
                  â”‚   Nano    â”‚
                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â”‚ D5
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ WS2812B   â”‚
                  â”‚ LED Strip â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**NEW DESIGN** (receives RPM from ESP32-S3):
```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    OBD-II â”€â”€â”€â”€â”€â†’ â”‚   ESP32-S3   â”‚ â†â”€â”€ Reads CAN directly
                  â”‚    HUB       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Serial (GPIO 43 TX)
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Arduino  â”‚ â†â”€â”€ Simplified code (no CAN library needed)
                  â”‚   Nano    â”‚
                  â”‚   D2 RX   â”‚
                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â”‚ D5
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ WS2812B   â”‚
                  â”‚ LED Strip â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Benefits of New Architecture

1. **Simplified Arduino Code**: Remove MCP2515/CAN library, just read serial
2. **Freed SPI Pins**: D10-D13 available for other uses
3. **Single CAN Tap**: ESP32-S3 handles all CAN reading
4. **Reduced Wiring**: No need for Arduino's MCP2515 module
5. **Lower Cost**: One less MCP2515 module required

### Serial Protocol (ESP32-S3 â†’ Arduino)

Simple format for RPM transmission:
```
RPM:3500\n    // Send RPM value with newline terminator
```

Arduino parsing example:
```cpp
// Simplified Arduino code (no CAN library)
void loop() {
    if (Serial.available()) {
        String data = Serial.readStringUntil('\n');
        if (data.startsWith("RPM:")) {
            currentRPM = data.substring(4).toInt();
            updateLEDs(currentRPM);
        }
    }
}
```

### Migration Path

| Step | Action | Status |
|------|--------|--------|
| 1 | Keep current Arduino code working | âœ… Working |
| 2 | Add Serial receive to Arduino | â¬œ TODO |
| 3 | Remove MCP2515 code from Arduino | â¬œ TODO |
| 4 | Program ESP32-S3 to forward RPM | â¬œ TODO |
| 5 | Disconnect Arduino's MCP2515 | â¬œ TODO |
| 6 | Connect ESP32-S3 TX â†’ Arduino D2 | â¬œ TODO |

---

### Complete Physical Wiring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COMPLETE WIRING DIAGRAM                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              OBD-II Connector                                â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                           â”‚  1  2  3  4  5  â”‚                                â”‚
â”‚                           â”‚  â—  â—  â—  â—  â—  â”‚                                â”‚
â”‚                           â”‚  6  7  8  9  ... â”‚                                â”‚
â”‚                           â”‚  â—  â—  â—  â—     â”‚                                â”‚
â”‚                           â”‚ 10 11 12 13 14  â”‚                                â”‚
â”‚                           â”‚  â—  â—  â—  â—  â—  â”‚                                â”‚
â”‚                           â””â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”˜                                â”‚
â”‚                               â”‚  â”‚     â”‚  â”‚                                  â”‚
â”‚          MS-CAN H (Pin 3) â”€â”€â”€â”€â”˜  â”‚     â”‚  â””â”€â”€â”€â”€ HS-CAN L (Pin 14)           â”‚
â”‚          MS-CAN L (Pin 11) â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€ HS-CAN H (Pin 6)            â”‚
â”‚                    â”‚                              â”‚                          â”‚
â”‚                    â–¼                              â–¼                          â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚            â”‚  MCP2515 #2  â”‚               â”‚  MCP2515 #1  â”‚                  â”‚
â”‚            â”‚   MS-CAN     â”‚               â”‚   HS-CAN     â”‚                  â”‚
â”‚            â”‚   125kbps    â”‚               â”‚   500kbps    â”‚                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                   â”‚ SPI                          â”‚ SPI                       â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                    â”‚        ESP32-S3             â”‚                           â”‚
â”‚                    â”‚      Round Display          â”‚                           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â”‚              â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â–¼                                        â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚   Arduino Nano    â”‚                  â”‚   Raspberry Pi    â”‚             â”‚
â”‚    â”‚   D2 â†â”€â”€ ESP TX   â”‚                  â”‚   WiFi/Serial     â”‚             â”‚
â”‚    â”‚   D5 â”€â”€â†’ WS2812B  â”‚                  â”‚   HDMI â”€â”€â†’ AVH    â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Button Navigation System

### Button Mapping Concept

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BUTTON MAPPING CONCEPT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   LEFT SIDE (Audio)              RIGHT SIDE (Cruise)                        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                         â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚  VOL+ â”‚ = ADJUST UP          â”‚ ON/OFF â”‚  â”‚ CANCEL â”‚                     â”‚
â”‚   â”‚   â–²   â”‚                      â”‚ SELECT â”‚  â”‚  BACK  â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚  VOL- â”‚ = ADJUST DOWN        â”‚  RES+  â”‚  â”‚  SET-  â”‚                     â”‚
â”‚   â”‚   â–¼   â”‚                      â”‚   UP   â”‚  â”‚  DOWN  â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚ SEEKâ–² â”‚  â”‚ SEEKâ–¼ â”‚  â”‚ MODE â”‚ â—„â”€â”€ Switch Device/Screen                  â”‚
â”‚   â”‚ RIGHT â”‚  â”‚ LEFT  â”‚  â”‚ SWAP â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”                                                                   â”‚
â”‚   â”‚ MUTE â”‚ = TOGGLE DISPLAY/SLEEP                                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”˜                                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Unified Button Actions

| Button | Global Action | Context-Aware |
|--------|---------------|---------------|
| **MODE** | Switch focus: ESP32 â†” Pi | Always available |
| **MUTE** | Toggle active display on/off | Sleep mode |
| **CANCEL** | Back / Exit to previous | Universal back |
| **ON/OFF** | Select / Enter / Confirm | Universal select |
| **RES+** | Navigate UP | Scroll up, Zoom in |
| **SET-** | Navigate DOWN | Scroll down, Zoom out |
| **SEEKâ–²** | Navigate RIGHT | Next item, Pan right |
| **SEEKâ–¼** | Navigate LEFT | Prev item, Pan left |
| **VOL+** | Increase value | Brightness, volume, threshold |
| **VOL-** | Decrease value | Brightness, volume, threshold |

---

## ESP32-S3 Display UI

### Screen Hierarchy

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           MAIN SCREENS               â”‚
                    â”‚         (MODE cycles â†’)              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼           â–¼               â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  RPM  â”‚  â”‚ SPEED â”‚  â”‚  G-FORCE  â”‚  â”‚  ENGINE   â”‚  â”‚  LAP  â”‚  â”‚ SETUP â”‚
â”‚ GAUGE â”‚  â”‚ +GEAR â”‚  â”‚  METER    â”‚  â”‚   TEMPS   â”‚  â”‚ TIMER â”‚  â”‚ MENU  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen Designs

#### Screen 1: RPM Gauge
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â”‚
        â”‚   â•­â”€â”¤ 3   5   7  â”œâ”€â•®  â”‚
        â”‚  â•±  â”‚    â•²â”‚â•±      â”‚  â•² â”‚
        â”‚ â”‚ 1 â”‚     â”‚       â”‚ R â”‚ â”‚
        â”‚  â•²  â”‚    â•±â”‚â•²      â”‚  â•± â”‚
        â”‚   â•°â”€â”¤             â”œâ”€â•¯  â”‚
        â”‚     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â”‚
        â”‚         3500           â”‚
        â”‚          RPM           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Screen 2: Speed + Gear
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚
        â”‚          65            â”‚
        â”‚         MPH            â”‚
        â”‚                        â”‚
        â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚     â”‚      3      â”‚    â”‚
        â”‚     â”‚    GEAR     â”‚    â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Screen 6: Setup Menu
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       SETTINGS         â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ â–¶ Brightness      80%  â”‚
        â”‚   Shift RPM     6500   â”‚
        â”‚   Redline RPM   7200   â”‚
        â”‚   LED Colors   Rainbow â”‚
        â”‚   Units        MPH     â”‚
        â”‚   WiFi         ON      â”‚
        â”‚   â—€ Back               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        RES+/SET- = Navigate
        ON/OFF = Select/Edit
        VOL+/- = Adjust value
        CANCEL = Back
```

---

## Raspberry Pi UI

### Home Screen (800x480)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“º PI ACTIVE                                            12:34 PM      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚   ğŸ—ºï¸   â”‚   â”‚   ğŸµ   â”‚   â”‚   ğŸ“Š   â”‚   â”‚   âš™ï¸   â”‚            â”‚
â”‚      â”‚  MAPS   â”‚   â”‚  MUSIC  â”‚   â”‚TELEMETRYâ”‚   â”‚SETTINGS â”‚            â”‚
â”‚      â”‚         â”‚   â”‚         â”‚   â”‚         â”‚   â”‚         â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚          â–²                                                              â”‚
â”‚          â””â”€â”€ Currently selected (highlighted)                           â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â—€ SEEK    â–²RES+    â—SELECT    â–¼SET-    CANCELâ–¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### App Screens

#### Maps App
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ—ºï¸ MAPS                                   CANCEL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                 â”‚ â”‚
â”‚  â”‚                   MAP VIEW                      â”‚ â”‚
â”‚  â”‚                                                 â”‚ â”‚
â”‚  â”‚                     ğŸ“                          â”‚ â”‚
â”‚  â”‚                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â”‚  RES+/SET- = Zoom    SEEK = Pan    CANCEL = Back     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Music App
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸµ MUSIC                                  CANCEL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚           Now Playing:                                â”‚
â”‚           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚           Song Title Here                             â”‚
â”‚           Artist Name                                 â”‚
â”‚                                                       â”‚
â”‚              â—€â—€  â–¶  â–¶â–¶                               â”‚
â”‚           â—€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â–¶                          â”‚
â”‚           0:45          3:21                          â”‚
â”‚                                                       â”‚
â”‚  VOL+/- = Volume    SEEK = Track    CANCEL = Back    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Telemetry App
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“Š TELEMETRY                              CANCEL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  RPM:    3,500  â”‚  â”‚  Speed:  65 mph â”‚           â”‚
â”‚   â”‚  Gear:      3   â”‚  â”‚  Throttle:  45% â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  ECT:    185Â°F  â”‚  â”‚  IAT:     95Â°F  â”‚           â”‚
â”‚   â”‚  AFR:    14.7   â”‚  â”‚  Oil:    210Â°F  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                       â”‚
â”‚  RES+/SET- = Scroll    CANCEL = Back                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Machine

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    START     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         DUAL DEVICE MODE        â”‚
                    â”‚   ESP32 = Primary (Gauges)      â”‚
                    â”‚   Pi = Secondary (Apps)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                         â”‚
                    MODE â”‚                         â”‚ MODE
                         â–¼                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ESP32 FOCUSED   â”‚      â”‚    PI FOCUSED    â”‚
              â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚      â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
              â”‚                  â”‚      â”‚                  â”‚
              â”‚  All buttons     â”‚      â”‚  All buttons     â”‚
              â”‚  control ESP32   â”‚â—„â”€â”€â”€â”€â–¶â”‚  control Pi      â”‚
              â”‚                  â”‚ MODE â”‚  via WiFi/Serial â”‚
              â”‚  Pi shows static â”‚      â”‚  ESP32 shows     â”‚
              â”‚  or auto content â”‚      â”‚  gauges only     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                         â”‚
                    MUTE â”‚                         â”‚ MUTE
                         â–¼                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   ESP32 SLEEP    â”‚      â”‚    PI SLEEP      â”‚
              â”‚   (screen off)   â”‚      â”‚   (screen dim)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference Card

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    MX5 STEERING WHEEL CONTROLS                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                        â•‘
â•‘   MODE â”€â”€â”€â”€â”€â”€â”€ Switch between ESP32 and Pi control                    â•‘
â•‘   MUTE â”€â”€â”€â”€â”€â”€â”€ Toggle display sleep/wake                              â•‘
â•‘                                                                        â•‘
â•‘   ON/OFF â”€â”€â”€â”€â”€ SELECT / ENTER / CONFIRM                               â•‘
â•‘   CANCEL â”€â”€â”€â”€â”€ BACK / EXIT / ESCAPE                                   â•‘
â•‘                                                                        â•‘
â•‘   RES+ â”€â”€â”€â”€â”€â”€â”€ UP / SCROLL UP / ZOOM IN                               â•‘
â•‘   SET- â”€â”€â”€â”€â”€â”€â”€ DOWN / SCROLL DOWN / ZOOM OUT                          â•‘
â•‘   SEEKâ–² â”€â”€â”€â”€â”€â”€ RIGHT / NEXT                                           â•‘
â•‘   SEEKâ–¼ â”€â”€â”€â”€â”€â”€ LEFT / PREVIOUS                                        â•‘
â•‘                                                                        â•‘
â•‘   VOL+ â”€â”€â”€â”€â”€â”€â”€ INCREASE (volume, brightness, value)                   â•‘
â•‘   VOL- â”€â”€â”€â”€â”€â”€â”€ DECREASE (volume, brightness, value)                   â•‘
â•‘                                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Implementation Phases

### Phase 1: CAN Bus Reading âœ…
- [ ] Wire MCP2515 #1 to HS-CAN
- [ ] Wire MCP2515 #2 to MS-CAN
- [ ] Verify CAN message reading
- [ ] Identify exact SWC button CAN IDs by sniffing

### Phase 2: ESP32-S3 Display
- [ ] Set up ESP32-S3 with round display
- [ ] Implement dual MCP2515 SPI reading
- [ ] Create gauge UI screens
- [ ] Implement button navigation
- [ ] Forward RPM to Arduino via Serial

### Phase 3: Raspberry Pi Integration
- [ ] Set up WiFi/Serial communication from ESP32
- [ ] Create Pi button daemon (receives commands, simulates keypresses)
- [ ] Build Pi launcher application
- [ ] Configure HDMI output for AVH-W4500NEX (800x480)

### Phase 4: Integration & Testing
- [ ] Test in-car with real CAN data
- [ ] Fine-tune button mappings
- [ ] Optimize display refresh rates
- [ ] Power management (sleep/wake)

---

## Parts List

| Item | Qty | Est. Cost | Notes |
|------|-----|-----------|-------|
| MCP2515 CAN Module | 2 | $10 | For ESP32-S3 (HS + MS CAN) |
| ESP32-S3 1.85" Round Display | 1 | $25 | Waveshare/AliExpress |
| OBD-II Breakout/Splitter | 1 | $15 | Access CAN bus pins |
| Jumper Wires (M-F, M-M) | 1 pack | $8 | Various connections |
| LM2596 Buck Converter | 1 | $8 | 12V â†’ 5V 3A (already in use) |
| Project Enclosure | 1 | $10 | Mount electronics |
| **Already Owned** | | | |
| Arduino Nano | 1 | - | âœ… Existing |
| WS2812B LED Strip (20) | 1 | - | âœ… Existing |
| MCP2515 CAN Module | 1 | - | âœ… Existing (can repurpose for ESP32) |
| Raspberry Pi 4B | 1 | - | âœ… Existing |
| **Total New Parts** | | **~$66** | |

---

## Raspberry Pi Configuration

### Current Setup (192.168.1.28)
- **OS**: Debian Buster (Raspberry Pi OS)
- **HDMI**: 800x480 @ 60Hz (Pioneer native resolution)
- **Boot Config**: `hdmi_force_hotplug=1` enabled for headless operation
- **VNC**: Enabled for remote access
- **SSH**: Key-based authentication configured
- **Wallpaper**: MX5 custom image

### Installed Touch/Input Tools
- `onboard` - On-screen keyboard (auto-show enabled)
- `matchbox-keyboard` - Lightweight keyboard alternative  
- `xdotool` - Simulate mouse/keyboard input
- `unclutter` - Auto-hide cursor

---

## Revision History

| Date | Version | Changes |
|------|---------|---------|
| 2025-12-08 | 0.1 | Initial concept document |

---

## Notes & Ideas

- Consider adding voice control via ESP32-S3's speech recognition
- Could add lap timer functionality with GPS module
- Bluetooth OBD adapter as backup/alternative to wired CAN
- Android Auto via OpenAuto Pro as future enhancement
